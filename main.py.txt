import os
from telegram import (
    Update,
    InlineKeyboardButton,
    InlineKeyboardMarkup,
)
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    CallbackQueryHandler,
    ContextTypes,
)

# ğŸ‘‡ ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª Ø§Ø² Ù…Ø­ÛŒØ· Replit Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…
BOT_TOKEN = os.environ.get("TELEGRAM_BOT_TOKEN")
if not BOT_TOKEN:
    raise ValueError("Ù„Ø·ÙØ§Ù‹ TELEGRAM_BOT_TOKEN Ø±Ùˆ Ø§Ø² Secrets ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯!")

# ================== Ù…ØªÙ†â€ŒÙ‡Ø§ Ùˆ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ ==================
texts = {
    "menu": "ğŸ‘‹ Ø¨Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ… Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ!\n\nÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:",
    "stars": (
        "â­ <b>Ø§Ø³ØªØ§Ø±Ø² ØªÙ„Ú¯Ø±Ø§Ù…</b>\n\n"
        "<code>1 Star = 2,050T</code>\n\n"
        "50â­ â€” 102,500T\n"
        "100â­ â€” 205,000T\n"
        "200â­ â€” 410,000T\n"
        "500â­ â€” 1,025,000T\n"
        "1Kâ­ â€” 2,050,000T\n"
        "2.5Kâ­ â€” 5,125,000T\n"
        "5Kâ­ â€” 10,250,000T\n"
        "10Kâ­ â€” 20,500,000T"
    ),
    "premium": (
        "ğŸ’ <b>ØªÙ„Ú¯Ø±Ø§Ù… Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…</b>\n\n"
        "3 Ù…Ø§Ù‡Ù‡ â€” 1,550,000T\n"
        "6 Ù…Ø§Ù‡Ù‡ â€” 2,120,000T\n"
        "12 Ù…Ø§Ù‡Ù‡ â€” 3,645,000T"
    ),
    "spotify": (
        "ğŸ§ <b>Ø§Ø³Ù¾Ø§ØªÛŒÙØ§ÛŒ Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…</b>\n\n"
        "ØªÚ©â€ŒÚ©Ø§Ø±Ø¨Ø±Ù‡ ÙÙ…ÛŒÙ„ÛŒ â€” 350,000T\n"
        "ØªÚ©â€ŒÚ©Ø§Ø±Ø¨Ø±Ù‡ Ø§Ø®ØªØµØ§ØµÛŒ â€” 1,500,000T"
    ),
    "apple": (
        "ğŸ <b>Ø§Ù¾Ù„ Ù…ÙˆØ²ÛŒÚ© Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…</b>\n\n"
        "ØªÚ©â€ŒÚ©Ø§Ø±Ø¨Ø±Ù‡ ÙÙ…ÛŒÙ„ÛŒ â€” 350,000T\n"
        "ØªÚ©â€ŒÚ©Ø§Ø±Ø¨Ø±Ù‡ Ø§Ø®ØªØµØ§ØµÛŒ â€” 1,300,000T"
    ),
    "gift": "ğŸ Ø¨Ø®Ø´ Ú¯ÛŒÙØª ØªÙ„Ú¯Ø±Ø§Ù… Ø¨Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒØ´Ù‡!",
}

# ================== Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ ==================
def main_menu():
    return InlineKeyboardMarkup([
        [InlineKeyboardButton("â­ Ø§Ø³ØªØ§Ø±Ø² ØªÙ„Ú¯Ø±Ø§Ù…", callback_data="stars")],
        [InlineKeyboardButton("ğŸ’ ØªÙ„Ú¯Ø±Ø§Ù… Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…", callback_data="premium")],
        [InlineKeyboardButton("ğŸ§ Ø§Ø³Ù¾Ø§ØªÛŒÙØ§ÛŒ Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…", callback_data="spotify")],
        [InlineKeyboardButton("ğŸ Ø§Ù¾Ù„ Ù…ÙˆØ²ÛŒÚ© Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…", callback_data="apple")],
        [InlineKeyboardButton("ğŸ Ú¯ÛŒÙØª ØªÙ„Ú¯Ø±Ø§Ù…", callback_data="gift")],
    ])

def back_button():
    return InlineKeyboardMarkup([
        [InlineKeyboardButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ Ø§ØµÙ„ÛŒ", callback_data="menu")]
    ])

# ================== Ø¯Ø³ØªÙˆØ±Ø§Øª ==================
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        texts["menu"], reply_markup=main_menu(), parse_mode="HTML"
    )

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    data = query.data

    if data in texts:
        text = texts[data]
        keyboard = back_button() if data != "menu" else main_menu()
        await query.edit_message_text(
            text=text, reply_markup=keyboard, parse_mode="HTML"
        )

# ================== Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª ==================
async def main():
    app = ApplicationBuilder().token(BOT_TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(button_handler))

    print("ğŸ¤– Bot is running...")
    await app.run_polling()

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())